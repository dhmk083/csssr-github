{
  "url": "https://api.github.com/repos/microsoft/TypeScript/issues/48907",
  "repository_url": "https://api.github.com/repos/microsoft/TypeScript",
  "labels_url": "https://api.github.com/repos/microsoft/TypeScript/issues/48907/labels{/name}",
  "comments_url": "https://api.github.com/repos/microsoft/TypeScript/issues/48907/comments",
  "events_url": "https://api.github.com/repos/microsoft/TypeScript/issues/48907/events",
  "html_url": "https://github.com/microsoft/TypeScript/issues/48907",
  "id": 1222137837,
  "node_id": "I_kwDOAT9aAc5I2Fft",
  "number": 48907,
  "title": "JSON: more general type of `JSON.parse()`",
  "user": {
    "login": "dev-itsheng",
    "id": 10683193,
    "node_id": "MDQ6VXNlcjEwNjgzMTkz",
    "avatar_url": "https://avatars.githubusercontent.com/u/10683193?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/dev-itsheng",
    "html_url": "https://github.com/dev-itsheng",
    "followers_url": "https://api.github.com/users/dev-itsheng/followers",
    "following_url": "https://api.github.com/users/dev-itsheng/following{/other_user}",
    "gists_url": "https://api.github.com/users/dev-itsheng/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/dev-itsheng/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/dev-itsheng/subscriptions",
    "organizations_url": "https://api.github.com/users/dev-itsheng/orgs",
    "repos_url": "https://api.github.com/users/dev-itsheng/repos",
    "events_url": "https://api.github.com/users/dev-itsheng/events{/privacy}",
    "received_events_url": "https://api.github.com/users/dev-itsheng/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [],
  "milestone": null,
  "comments": 12,
  "created_at": "2022-05-01T12:16:21Z",
  "updated_at": "2022-05-02T05:18:23Z",
  "closed_at": "2022-05-02T05:18:22Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "# lib Update Request\r\n\r\n<!--\r\n  Please fill in each section completely. Thank you!\r\n\r\n  Are you here for one of these commonly-requested lib changes?\r\n    * Object.keys - see https://stackoverflow.com/questions/55012174/\r\n    * Array methods - see https://github.com/microsoft/TypeScript/issues/36554\r\n    * parseInt, parseFloat, isFinite, isNaN, etc. - see https://github.com/microsoft/TypeScript/issues/4002\r\n\r\n  The DOM lib is maintained elsewhere and you can skip a step by filing issues/PRs for the DOM at that repo.\r\n  See https://github.com/microsoft/TypeScript-DOM-lib-generator\r\n-->\r\n\r\n## Configuration Check\r\n\r\n<!--\r\n  If you're missing common new methods like Array.includes, you may have a misconfigured project.\r\n  Try setting `lib: \"es2020\"` and checking whether the type you want is present.\r\n  You can diagnose further by running `tsc` with `--listFilesOnly` or `--showConfig`.\r\n\r\n  Conversely, if you are seeing built-in methods you expect to *not* see, check your 'lib' setting\r\n  or review your dependencies for lib/reference directives that might be polluting\r\n  your global scope. This is common when using the 'node' type library. See https://github.com/microsoft/TypeScript/issues/40184\r\n\r\n  Replace the text below:\r\n-->\r\n\r\nMy compilation *target* is `ES2015` and my *lib* is `the default`.\r\n\r\n## Missing / Incorrect Definition\r\n\r\n<!--\r\n  What property, method, function, etc is missing or incorrect?\r\n-->\r\n\r\n`JSON.parse`ã€‚\r\n\r\n## Sample Code\r\n\r\n<!--\r\n  What's some code using this that should work, but doesn't?\r\n-->\r\n\r\nIn Node.js:\r\n\r\n```typescript\r\nimport fs from 'fs';\r\n\r\nconst packageJson = JSON.parse(fs.readFileSync('./package.json'));\r\n```\r\n\r\nTypeScript throw a new Error `TS2345: Argument of type 'Buffer' is not assignable to parameter of type 'string'`.\r\n\r\nBut it works.\r\n\r\nBecause according to the [ECMAScript 5 version of the documentation](https://262.ecma-international.org/5.1/#sec-15.12.2), `JSON.parse()`, when executed, will first convert the incoming parameters Call the `ToString` internal method.\r\n\r\nAnd according to [Node.js related code](https://github.com/nodejs/node/blob/master/lib/buffer.js#L784), the Buffer object will be converted to utf8 when calling `toString` string.\r\n\r\nThat is, this parameter can be of any type, for example:\r\n\r\n```javascript\r\nconst obj = {\r\n    toString() {\r\n        return '[1, 2, 3]'\r\n    }\r\n};\r\n\r\nconst arr = JSON.parse(obj);    // [1, 2, 3]\r\n```\r\n\r\nTypeScript still throw error:\r\n\r\n<img width=\"769\" alt=\"image\" src=\"https://user-images.githubusercontent.com/10683193/166145319-0d278a0e-7f18-40a2-91c5-dad9dd678fab.png\">\r\n\r\nYou can also try it on [TypeScript PlayGround](https://www.typescriptlang.org/play?#code/MYewdgzgLgBCBGArGBeGBvAUDHMogGUoAnASzAHMAKASg210eIFMoBXYsGAcgG0BGADQwATMIDMAXW4McAX0xyA3JkyhIsAIbFiqGACkCAeQByAOgAO2iMyoJENJUA).\r\n\r\nI had to disable [an ESLint rule](https://github.com/sindresorhus/eslint-plugin-unicorn/blob/main/docs/rules/prefer-json-parse-buffer.md) for the same reason.\r\n\r\n## Documentation Link\r\n\r\n<!--\r\n  Link to relevant documentation (e.g. MDN, W3C, ECMAScript Spec) to consult for this property.\r\n  Note that lib.dom.d.ts intentionally does not include browser-specific extensions\r\n   or early experimental features.\r\n-->\r\n",
  "closed_by": {
    "login": "dev-itsheng",
    "id": 10683193,
    "node_id": "MDQ6VXNlcjEwNjgzMTkz",
    "avatar_url": "https://avatars.githubusercontent.com/u/10683193?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/dev-itsheng",
    "html_url": "https://github.com/dev-itsheng",
    "followers_url": "https://api.github.com/users/dev-itsheng/followers",
    "following_url": "https://api.github.com/users/dev-itsheng/following{/other_user}",
    "gists_url": "https://api.github.com/users/dev-itsheng/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/dev-itsheng/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/dev-itsheng/subscriptions",
    "organizations_url": "https://api.github.com/users/dev-itsheng/orgs",
    "repos_url": "https://api.github.com/users/dev-itsheng/repos",
    "events_url": "https://api.github.com/users/dev-itsheng/events{/privacy}",
    "received_events_url": "https://api.github.com/users/dev-itsheng/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/microsoft/TypeScript/issues/48907/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/microsoft/TypeScript/issues/48907/timeline",
  "performed_via_github_app": null
}
